# 数据库配置说明

## 配置方式

### 方式一：微信云托管部署（生产环境）

当前 `application.yml` 使用环境变量配置，这是微信云托管的标准方式。

**在微信云托管控制台设置环境变量：**

1. 进入「服务设置」->「环境变量」
2. 添加以下环境变量：
   - `MYSQL_ADDRESS`: 数据库地址（例如：`127.0.0.1:3306`）
   - `MYSQL_USERNAME`: 数据库用户名
   - `MYSQL_PASSWORD`: 数据库密码
   - `MYSQL_DATABASE`: 数据库名称（可选，默认：`springboot_demo`）

**数据库初始化：**

1. 在微信云托管控制台的「数据库」中创建数据库
2. 执行 `src/main/resources/db.sql` 中的SQL脚本创建表结构

### 方式二：本地开发

**选项1：使用本地配置文件（推荐）**

1. 修改 `src/main/resources/application-local.yml` 中的数据库配置：
   ```yaml
   url: jdbc:mysql://localhost:3306/sport_fun?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai
   username: root
   password: your_password  # 修改为你的数据库密码
   ```

2. 运行项目时指定profile：
   ```bash
   mvn spring-boot:run -Dspring-boot.run.profiles=local
   ```
   或者在IDE中设置Active profiles为 `local`

3. 创建数据库并执行SQL脚本：
   ```sql
   CREATE DATABASE IF NOT EXISTS sport_fun;
   USE sport_fun;
   -- 然后执行 src/main/resources/db.sql 中的所有SQL语句
   ```

**选项2：设置系统环境变量**

在Windows PowerShell中：
```powershell
$env:MYSQL_ADDRESS="localhost:3306"
$env:MYSQL_USERNAME="root"
$env:MYSQL_PASSWORD="your_password"
$env:MYSQL_DATABASE="sport_fun"
```

在Linux/Mac中：
```bash
export MYSQL_ADDRESS=localhost:3306
export MYSQL_USERNAME=root
export MYSQL_PASSWORD=your_password
export MYSQL_DATABASE=sport_fun
```

## 数据库初始化步骤

1. **创建数据库**
   ```sql
   CREATE DATABASE IF NOT EXISTS sport_fun DEFAULT CHARSET utf8mb4 COLLATE utf8mb4_unicode_ci;
   ```

2. **执行建表脚本**
   - 打开 `src/main/resources/db.sql`
   - 在数据库中执行所有CREATE TABLE语句

3. **验证表结构**
   ```sql
   USE sport_fun;
   SHOW TABLES;
   ```
   应该看到以下表：
   - users
   - teams
   - team_members
   - sport_opportunities
   - sport_records
   - notifications

## 注意事项

1. **字符集**：确保数据库使用 `utf8mb4` 字符集，支持emoji等特殊字符
2. **时区**：建议设置数据库时区为 `Asia/Shanghai`
3. **连接池**：Spring Boot会自动配置HikariCP连接池
4. **安全性**：生产环境不要将密码硬编码在配置文件中，使用环境变量或密钥管理服务

