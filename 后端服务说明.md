# 团队每月运动机会管理系统 - 后端服务说明

## 项目结构

```
src/main/java/com/tencent/wxcloudrun/
├── config/              # 配置类
│   ├── ApiResponse.java          # 统一响应格式
│   ├── CorsConfig.java           # 跨域配置
│   └── GlobalExceptionHandler.java  # 全局异常处理
├── controller/          # 控制器层
│   ├── AuthController.java           # 用户认证
│   ├── TeamController.java           # 团队管理
│   ├── SportOpportunityController.java  # 运动机会管理
│   ├── SportRecordController.java      # 运动记录管理
│   ├── StatisticsController.java      # 统计报表
│   └── NotificationController.java     # 消息通知
├── dao/                 # 数据访问层
│   ├── UserMapper.java
│   ├── TeamMapper.java
│   ├── TeamMemberMapper.java
│   ├── SportOpportunityMapper.java
│   ├── SportRecordMapper.java
│   └── NotificationMapper.java
├── dto/                 # 数据传输对象
│   ├── WechatLoginRequest.java
│   ├── CreateTeamRequest.java
│   ├── JoinTeamRequest.java
│   ├── AllocateOpportunityRequest.java
│   ├── UseOpportunityRequest.java
│   ├── UpdateSportRecordRequest.java
│   ├── SportRecordFilterRequest.java
│   └── StatisticsResponse.java
├── model/               # 实体类
│   ├── User.java
│   ├── Team.java
│   ├── TeamMember.java
│   ├── SportOpportunity.java
│   ├── SportRecord.java
│   └── Notification.java
└── service/             # 服务层
    ├── UserService.java
    ├── TeamService.java
    ├── SportOpportunityService.java
    ├── SportRecordService.java
    ├── StatisticsService.java
    ├── NotificationService.java
    └── impl/            # 服务实现
        ├── UserServiceImpl.java
        ├── TeamServiceImpl.java
        ├── SportOpportunityServiceImpl.java
        ├── SportRecordServiceImpl.java
        ├── StatisticsServiceImpl.java
        └── NotificationServiceImpl.java
```

## 数据库初始化

1. 执行 `src/main/resources/db.sql` 中的SQL脚本创建数据库表
2. 确保 `application.yml` 中的数据库配置正确

## 技术栈

- Spring Boot 2.5.5
- MyBatis 2.0.1
- MySQL
- Lombok
- Jackson (JSON处理)

## 主要功能模块

### 1. 用户认证模块
- 微信登录（需要集成微信API获取openid）

### 2. 团队管理模块
- 创建团队
- 加入团队（通过邀请码）
- 团队成员管理
- 团队信息查询

### 3. 运动机会管理模块
- 管理员分配运动机会
- 查看可用机会
- 机会使用状态管理

### 4. 运动记录模块
- 使用机会创建运动记录
- 运动记录查询、更新、删除
- 支持筛选和分页

### 5. 统计报表模块
- 个人运动统计
- 团队运动统计
- 排行榜功能

### 6. 消息通知模块
- 通知列表查询
- 未读通知统计
- 标记已读功能

## 注意事项

1. **用户认证**: 当前微信登录接口中，openid的获取需要调用微信API，代码中暂时使用code作为openid，实际使用时需要替换。

2. **请求头**: 除登录接口外，所有接口都需要在请求头中传递 `X-User-Id` 来标识当前用户。

3. **权限控制**: 
   - 团队管理员权限检查通过 `TeamService.isTeamAdmin()` 方法
   - 数据操作权限通过比较 `userId` 实现

4. **事务管理**: 涉及多表操作的Service方法已添加 `@Transactional` 注解

5. **异常处理**: 全局异常处理器会捕获所有异常并返回统一格式的错误响应

6. **跨域配置**: 已配置CORS，支持跨域请求

## 部署说明

1. 确保MySQL数据库已创建并配置
2. 执行数据库初始化脚本
3. 配置 `application.yml` 中的数据库连接信息
4. 使用Maven构建项目: `mvn clean package`
5. 运行jar包或部署到微信云托管

## API文档

详细API文档请参考 `API文档.md`

